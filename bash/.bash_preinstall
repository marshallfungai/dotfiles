#!/usr/bin/env bash

# Detect OS and package manager
get_pkg_manager() {
  local pkg_manager
  local os_type

  # Detect OS
  case "$(uname -s)" in
    Linux*)
      os_type="Linux"
      # Check for WSL
      if grep -qi "microsoft" /proc/version; then
        os_type="WSL"
      fi
      # Check for apt (Debian/Ubuntu)
      if command -v apt &> /dev/null; then
        pkg_manager="apt"
      # Check for yum (RHEL/Fedora)
      elif command -v yum &> /dev/null; then
        pkg_manager="yum"
      # Check for pacman (Arch)
      elif command -v pacman &> /dev/null; then
        pkg_manager="pacman"
      fi
      ;;
    Darwin*)
      os_type="macOS"
      if command -v brew &> /dev/null; then
        pkg_manager="brew"
      fi
      ;;
    *)
      os_type="Unknown"
      ;;
  esac

  # Return both OS and package manager
  echo "${os_type}:${pkg_manager}"
}



install_pkg() {
  local pkg="$1"
  IFS=':' read -r os_type pkg_manager <<< "$(get_pkg_manager)"

  case "$pkg_manager" in
    apt)
      sudo apt-get install -y "$pkg" ;;
    brew)
      brew install "$pkg" ;;
    yum)
      sudo yum install -y "$pkg" ;;
    pacman)
      sudo pacman -S --noconfirm "$pkg" ;;
    *)
      echo "Error: No supported package manager found for $os_type!" >&2
      return 1
      ;;
  esac
}


# Usage:
install_pkg stow
install_pkg tmux
install_pkg neovim
install_pkg bind9-dnsutils
